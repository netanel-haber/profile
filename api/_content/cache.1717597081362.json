{"generatedAt":1717597093473,"generateTime":708,"contents":[{"_path":"/concurrency","_dir":"","_draft":false,"_partial":false,"_locale":"","title":"Concurrency","description":"","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"concurrency"},"children":[{"type":"text","value":"Concurrency"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This article aims to explain basic concepts related to concurrency, which is used to solve performance related problems. It starts and ends with Python (CPython, mostly), as a tie from and back into reality - but isn't really about Python at all. Actually, it isn't about any language, framework or library in particular. It aims to take a step back from questions of application and start from first principles."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's start by stating some facts about python concurrency. They may seem contradictory or confusing - the rest of the article aims to provide more clarity as to how they make sense together. It should be noted that some of these facts pertain to a standard use of Python - it is possible to bypass some limitations, either by using a less popular Python implementation, or by using non-standard "},{"type":"element","tag":"a","props":{"href":"https://numba.pydata.org/","rel":["nofollow"]},"children":[{"type":"text","value":"tools"}]},{"type":"text","value":" and libraries."}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Python has threads."}]},{"type":"text","value":"\nIf anyone says otherwise, they have important "},{"type":"element","tag":"a","props":{"href":"https://docs.python.org/3/library/threading.html","rel":["nofollow"]},"children":[{"type":"text","value":"standard"}]},{"type":"text","value":" Python "},{"type":"element","tag":"a","props":{"href":"https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor","rel":["nofollow"]},"children":[{"type":"text","value":"modules"}]},{"type":"text","value":" to explain away."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Python threads are useful"}]},{"type":"text","value":". "},{"type":"element","tag":"a","props":{"href":"https://replit.com/@NetanelHaber/pythonthreads?v=1","rel":["nofollow"]},"children":[{"type":"text","value":"Here are numbers for you to look at"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"No parallelization in python"}]},{"type":"text","value":": CPython threads cannot solve "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"every"}]},{"type":"text","value":" problem threads are put to use for in languages like C and C++."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Multi-processing can provide parallelization in Python"}]},{"type":"text","value":", although in practice the performance overhead will sometimes cancel out or severely reduce the wanted benefit"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-1","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-1"},"children":[{"type":"text","value":"1"}]}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So what is the rule? When is multi-threading useful? Why is Python different than some other languages?"}]},{"type":"element","tag":"h3","props":{"id":"types-of-work"},"children":[{"type":"text","value":"Types of work"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Two basic concepts in this space are "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/CPU-bound","rel":["nofollow"]},"children":[{"type":"text","value":"CPU-bound"}]}]},{"type":"text","value":" and "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/I/O_bound","rel":["nofollow"]},"children":[{"type":"text","value":"I/O-bound"}]}]},{"type":"text","value":" (Input/Output) work. It helps to first state a basic fact: Computers have a fundamental bottleneck - they cannot execute more than one command at any time. Modern \"computers\" actually contain multiple computation units that can each execute one command at any given time. To compare the two types of work, we will first look at a single CPU core."}]},{"type":"element","tag":"h4","props":{"id":"multithreading-cpu-bound-work-on-a-single-core-the-same-work-with-extra-steps"},"children":[{"type":"text","value":"Multithreading CPU-bound work on a single core - the same work with extra steps"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If we task this computer with calculating "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"(2 ^ 19) / (3 ^ 33)"}]},{"type":"text","value":", it will boil the task down to a list of discreet commands to execute"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-2","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-2"},"children":[{"type":"text","value":"2"}]}]},{"type":"text","value":". This is very similar to human calculation. Say we've neared the end of a meal at a restaurant. We have two tasks ahead of us: Calculating the tip and calculating when to leave in order to catch a bus. The former calculation may penalize us "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"X"}]},{"type":"text","value":" of our time, while the latter may take "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Y"}]},{"type":"text","value":" of our time. In other words, altogether "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"X+Y"}]},{"type":"text","value":" work must be done. The \"brain-power\" (=time) will be spent, regardless of the way the work is divided, sliced or diced. "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"This is CPU-bound work."}]}]},{"type":"element","tag":"h4","props":{"id":"a-watched-pot-never-boils"},"children":[{"type":"text","value":"A watched pot never boils"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now the computer is tasked with scraping Google search results. It receives a term as an argument and must retrieve the first 10 pages of results. So it:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Asks for the first page "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"10ms"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Waits for the result to return from Google servers "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"80ms"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Receives the result and saves it in a file "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"10ms"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It then repeats these steps for all 10 pages.\nThe execution times are just an example, but resemble real-world times for similar programs. So let's focus on 2 - it seems to be our performance bottleneck, at 80% of all execution time. The key word here is "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"waiting"}]},{"type":"text","value":". We have such a powerful tool at our disposal, and it mostly waits - i.e., does nothing, for most of our program. That's pretty unsavory. Next time you plan something with friends, try waiting for each friend to confirm before asking the next friend. "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"This is I/O-bound work"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So a "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"CPU-bound"}]},{"type":"text","value":" task is one where the primary performance bottleneck is actual "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"work"}]},{"type":"text","value":" that cannot be avoided. An "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"I/O-bound"}]},{"type":"text","value":" task is one where the primary performance bottleneck is actually just "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"waiting"}]},{"type":"text","value":" for an external piece of data."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is common sense that alleviating performance pain for problems with different bottlenecks will look different for each type of task. This is actually the key to our primary question. assessing the type of work before us - CPU, I/O or a mixture of both - can help us know in advance if certain solutions are applicable."}]},{"type":"element","tag":"h3","props":{"id":"enhancing-performance"},"children":[{"type":"text","value":"Enhancing Performance"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So for the first calculation task, we have a discreet list of commands we need to execute. Any unit can only execute one line at a time. We've already mentioned modern computers have many such units. So, for a slow program, the solution seems clear - divide and conquer. We divide our computation into smaller coherent parts (so we can assemble the solutions later for the final product), and give each available unit in the computer one part at a time to execute. For example, if we have a computation that can take 8X time, that can be divided into 8 smaller computations that each can take X time - and we have 8 cores - we can now accomplish this task in X time. This means that in order to enhance performance for CPU-bound tasks we need "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"parallelization"}]},{"type":"text","value":" - computing simultaneously on multiple units."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The second task, where we were mostly waiting, can complete faster by being able to do other work while waiting. In the wild, you might see the term "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"asynchronous"}]},{"type":"text","value":" used to describe such programs that allow for doing work while waiting, depending on the language or framework. We will use this term as well"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-3","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-3"},"children":[{"type":"text","value":"3"}]}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On a side note, let's notice a subtle difference between the enhancements we may gain from optimizing both types of work. While both parallelization and asynchronous solutions can "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"save on overall execution time"}]},{"type":"text","value":", they cannot both "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"reduce CPU usage and resources"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Consider 10 taps that produce 10L of water an hour. We need 100 liters altogether, so we're smart - we use 10 bottles and run all 10 taps at once. This should get us done in a minute, rather than 10 minutes. The trouble is the guy that arrived with us is also smart, and wants his 100L's worth of water too. This is the trouble with CPU work - the computer is capped at how much work it can accomplish simultaneously. To this end, \"optimizing\" your program by parallelizing its work doesn't really improve anything in terms of the amount of hard work that needs to be completed"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-4","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-4"},"children":[{"type":"text","value":"4"}]}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In contrast, optimizing I/O bound programs can actually "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"reduce CPU usage"}]},{"type":"text","value":" - one problem with I/O bound programs is that they needlessly waste CPU resources. In the best case scenario, we can get rid of almost all of the idle CPU time - which can be used to do more work"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-5","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-5"},"children":[{"type":"text","value":"5"}]}]},{"type":"text","value":" "},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-6","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-6"},"children":[{"type":"text","value":"6"}]}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"concurrency-1"},"children":[{"type":"text","value":"Concurrency"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So, CPU bound tasks could use parallel computing to achieve better performance, while for I/O bound tasks we would simply try to do more work while waiting. Generally, the blanket term for any solution for both of these bounds is "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"concurrency"}]},{"type":"text","value":". This denotes programs that cannot be thought about sequentially - in order to achieve either solution, the language will now expose syntax and interfaces that, while affording us the performance benefits of concurrent code, prevent us from being able to read our programs \"line after line\". It will now be possible for different bits of our programs to execute out of order."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's pause to list the terms we've encountered:"}]},{"type":"element","tag":"table","props":{},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"thead","props":{},"children":[{"type":"text","value":"\n   "},{"type":"element","tag":"tr","props":{},"children":[{"type":"text","value":"\n      "},{"type":"element","tag":"th","props":{"colSpan":"2"},"children":[{"type":"text","value":"Concurrency\n    "}]}]},{"type":"text","value":"\n    "},{"type":"element","tag":"tr","props":{},"children":[{"type":"text","value":"\n      "},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"I/O-bound"}]},{"type":"text","value":"\n      "},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"CPU-bound"}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n  "},{"type":"element","tag":"tbody","props":{},"children":[{"type":"text","value":"\n    "},{"type":"element","tag":"tr","props":{},"children":[{"type":"text","value":"\n      "},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"Asynchronous Programming"}]},{"type":"text","value":"\n      "},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"Parallel Programming"}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n  "}]}]},{"type":"element","tag":"h4","props":{"id":"challenges-on-the-way-to-real-world-solutions"},"children":[{"type":"text","value":"Challenges on the way to real-world solutions"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"As mentioned, different frameworks expose different interfaces to programmers for writing concurrent code. Fundamentally, there are two challenges for language designers:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Implementation"}]},{"type":"text","value":" - Developing the actual implementation(s) and mechanism(s) to allow for such code to run. This is not a trivial problem, especially if existing languages want to introduce new solutions."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Interface"}]},{"type":"text","value":" - Exposing the syntax and high-level tools with which users may interact with the implementations. This is also not a trivial problem - as mentioned, thinking about concurrent code isn't straightforward. Accordingly, a good language will look for interfaces that allow for expressing concurrent code in a readable, easy-to-reason-about way."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's give an example for a challenge on the implementation side. Cpython suffers from the "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"element","tag":"a","props":{"href":"https://www.youtube.com/watch?v=KVKufdTphKs","rel":["nofollow"]},"children":[{"type":"text","value":"GIL"}]}]},{"type":"text","value":" - the global interpreter lock. This means that the python interpreter cannot run more than one line of python bytecode at any given time. This means that Python effectively bans parallelization ("},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"within the same process"}]},{"type":"text","value":" - more on this soon), and therefore cannot improve the execution time of CPU-bound programs using concurrency"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-7","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-7"},"children":[{"type":"text","value":"7"}]}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's look at another example for a challenge, this time on the interface side. Javascript, an async language by default, used to only allow running code asynchronously using callbacks functions. These functions are passed to async calls (like api requests). These callbacks will eventually run with the result of async operations and execute side effects, such as displaying the result of the request on the page. Once we register a callback, we can continue working while the resource fetches."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This pattern suffered from a problem dubbed "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"element","tag":"a","props":{"href":"http://callbackhell.com/","rel":["nofollow"]},"children":[{"type":"text","value":"\"Callback Hell\""}]}]},{"type":"text","value":", where dependent chains of asynchronous calls, which by necessity meant nested callbacks, caused increasing right-indentation of code, until the final callback code started on the 100th column, say."}]},{"type":"text","value":"\n  "},{"type":"element","tag":"pre","props":{},"children":[{"type":"text","value":"  This\n              isn't\n                          a\n                                  pleasant\n                                                  read."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Addressing this, JavaScript introduced the "},{"type":"element","tag":"a","props":{"href":"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise","rel":["nofollow"]},"children":[{"type":"text","value":"Promise API"}]},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-8","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-8"},"children":[{"type":"text","value":"8"}]}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"a-taste-of-real-world-concurrency"},"children":[{"type":"text","value":"A Taste of Real-world Concurrency"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's take a cursory look at 3 basic archetypes of concurrency solutions, using a shoe factory as analogy."}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"Multiprocessing"}]},{"type":"text","value":" - multiprocessing can reduce the execution time of "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"both"}]},{"type":"text","value":" types of work. It involves using multiple OS processes within the same program, and coordinating between them. It is slow and very resource consuming in comparison with other concurrency solutions. If we use Python as an example, every process we spawn to run our code will, for example, contain its own running Python interpreter including the initial overhead of starting the process and the interpreter."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Multiprocessing is analogous to building a brand new shoe factory for every order of shoes we receive, rather than using existing factories to produce multiple shoes. Every factory has an enormous initial construction overhead, it takes up a lot of real estate, and sharing resources and information between the factories is very slow.\nBack to Python: The GIL, which limits Python execution to one line at a time, only enforces its lock within the same process since every process is its own complete Python entity. This means that Python can allow real cpu parallelization using multiprocessing (refer to "},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-1","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-1-2"},"children":[{"type":"text","value":"1"}]}]},{"type":"text","value":")"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"Multithreading"}]},{"type":"text","value":" - multithreading is a tricky, widely available solution for lean concurrency with shared resources within the same process. Threads are lighter execution units than processes. Let's refer back to the factory analogy. Here, we use just the one factory (=process) to run our code. We achieve concurrency by employing many workers to perform many tasks. The workers share the factory facilities and machines, so we save big on resources. If they can work at the same time (=in parallel), we can produce more in a given time ("},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"CPU-bound"}]},{"type":"text","value":" work)."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"It is important to state that multithreading can also provide performance benefits for ("},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"I/O-bound"}]},{"type":"text","value":" work). In languages with a GIL like Python, we effectively only allow one employee to work at any given time, and we switch between them. Why is this still useful? Workers, when not idle, can schedule deliveries, start long-running processes on machines, etc. - so if our factory mostly consists of kick-starting autonomous tasks ("},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"I/O-bound"}]},{"type":"text","value":" work), multiple employees can still accomplish much more than a single employee. With the meager time each employee is given, he can start some independent task, such as scheduling a delivery. We immediately yell \"freeze!\" and transfer the working rights to another worker. He too, registers some task. When we return to the first worker, our delivery has already arrived, and our worker can program a processing machine before we freeze him again."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Back to reality. While multithreading is the ideal solution for CPU-bound work, it is less than ideal for I/O bound work. Even in a language that allows multi-threaded parallelism, our program still has idle CPU usage while any given thread waits for some I/O operation to complete. In addition, context switching between threads is time consuming, and as running permission is a zero-sum game, every millisecond of time given to one thread is a millisecond taken from another. So every thread is still resource consuming (though much leaner than a full process)."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"Asynchronous Tasks"}]},{"type":"text","value":"- This solution is relevant to I/O bound work, and can solve the wasted resource issues highlighted in the previous paragraph when using multithreading for I/O bound work. This is the final improvement to our factory, and it includes paying one of our employees more so he's willing to \"multi-task\"."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Now, we hire a supervisor and buy a whiteboard. Our supervisor's job is to provide our employee with tasks to do when a task is completed. The worker schedules some delivery. Instead of waiting for the delivery, he first writes on the whiteboard: \"Supervisor, please let me know when the delivery has arrived for further processing\". Then he can immediately begin scheduling another delivery, or operating on deliveries from yesterday. The supervisor keeps an eye on the loading dock, and eventually the first delivery arrives. He erases the task from the whiteboard and tells the worker, who begins processing the delivery that just arrived. And so on."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"So this solution requires a couple of components, but it can saves immensely on resources when the work is mostly I/O bound - it needs a single thread for our actual code (the worker), and some constant number of other threads and data structures to inform our thread of new tasks and keep an eye out for completed async operations (the supervisor) and keep tabs on registered tasks (the whiteboard). Our code registers some async task, and requests to be notified when it returns with the results. It notifies the framework what it wants to do with the result, but the syntax of how it is notified and the underlying objects are very framework and languages specific."}]}]},{"type":"element","tag":"h3","props":{"id":"back-to-buzzwords"},"children":[{"type":"text","value":"Back to buzzwords"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The only way to get "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"parallelization"}]},{"type":"text","value":" in Python - in order to reduce execution time for "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"CPU-bound"}]},{"type":"text","value":" programs, is "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"multi-processing"}]},{"type":"text","value":", because of the "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"GIL"}]},{"type":"text","value":". This, by definition, doesn't come with shared resources like "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"multi-threading"}]},{"type":"text","value":" - so there's a large performance and resource penalty. This is not to say that threads have no use in Python - they may be used for reducing execution time for "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"I/O bound"}]},{"type":"text","value":" programs. Another Python-native alternative that can accomplish basically the same thing is the newish "},{"type":"element","tag":"a","props":{"href":"https://docs.python.org/3/library/asyncio.html","rel":["nofollow"]},"children":[{"type":"text","value":"asyncio"}]},{"type":"text","value":" library, that enables asynchronous code with a single thread."}]},{"type":"element","tag":"h3","props":{"id":"ack"},"children":[{"type":"text","value":"Ack"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Writing and resources about concurrency that I like:"}]}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Great "},{"type":"element","tag":"a","props":{"href":"https://www.youtube.com/watch?v=lJ3NC-R3gSI","rel":["nofollow"]},"children":[{"type":"text","value":"talk"}]},{"type":"text","value":" by Steve Klabnik."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Great "},{"type":"element","tag":"a","props":{"href":"https://eloquentjavascript.net/11_async.html","rel":["nofollow"]},"children":[{"type":"text","value":"chapter"}]},{"type":"text","value":" about async in eloquentJS, an outstanding book."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Friends that helped"}]}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Yoav Tzfati helped clean up my Python code"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Naomi Kriger and Yoav read my drafts"}]}]},{"type":"element","tag":"section","props":{"className":["footnotes"],"dataFootnotes":""},"children":[{"type":"element","tag":"h2","props":{"className":["sr-only"],"id":"footnote-label"},"children":[{"type":"text","value":"Footnotes"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{"id":"user-content-fn-1"},"children":[{"type":"text","value":"A Python developer friend of mine offered up the following heuristic: If you find yourself reaching for multi-processing in order to incorporate parallel code execution, it's time to choose a different language for this particular task. "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-1","ariaLabel":"Back to reference 1","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-1-2","ariaLabel":"Back to reference 1-2","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"},{"type":"element","tag":"sup","props":{},"children":[{"type":"text","value":"2"}]}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-2"},"children":[{"type":"text","value":"For brevity, we also implicitly disregard a further step where parallelism can come in handy - some calculations may perhaps allow for non-sequential execution of certain steps. This doesn't diminish the point, though. Say we've found the most reduced version of the algorithm, split among as many units as possible. We are still left with \"hard\" work needing to be completed. So we've tried our best to reach a solution in as little time as possible - but we still need to bite the bullet of real work needing to be done. "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-2","ariaLabel":"Back to reference 2","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-3"},"children":[{"type":"text","value":"Although you would be hard pressed to justify the semantics, based on needle-thin differences between the dictionary definitions of some of the above terms. "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-3","ariaLabel":"Back to reference 3","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-4"},"children":[{"type":"text","value":"I think that for a programmer like me, who's written only consumers - programs that just consume computing power - it may be harder to understand this perspective. Once you write a provider, such as an operating system, you suddenly understand this. You own "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"all"}]},{"type":"text","value":" of the resources - so when you parallelize management processes you'll notice you're stepping on your own toes - all of your programs are standing in line for water. "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-4","ariaLabel":"Back to reference 4","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-5"},"children":[{"type":"text","value":"We can also quantify CPU usage as energy expenditure to further illustrate the point. There is no \"free\" energy - to this end, parallelizing CPU-bound programs cannot save energy. Async code also cannot save energy - but it "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"can"}]},{"type":"text","value":" minimize wasting energy. A more concise (but, in reality, wrong) framing of this idea is that the ideal program is only bound by CPU usage, as a program where we've solved all I/O issues is left with only CPU usage. This program doesn't exist, except in theory. I/O includes loading the next CPU instructions and reading registers as well, for example. In addition, These are not the only two bounds a program may have, for example another extremely important bound is "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Memory-bound_function","rel":["nofollow"]},"children":[{"type":"text","value":"memory"}]}]},{"type":"text","value":", and a program is a tradeoff between all bounds. "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-5","ariaLabel":"Back to reference 5","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-6"},"children":[{"type":"text","value":"A clock-cycle saved is a clock-cycle earned. This key insight, that a best case scenario asynchronous framework may reduce CPU usage, is what allows event-driven servers to serve many concurrent requests when the requests are mostly I/O bound. A new thread need not be created to serve every request - this can save an enormous amount of resources, in contrast with a thread-per-request framework which is capped by the realistic amount of threads that the server can maintain, thus severely limiting the vertical scaling of the server's possible concurrent requests. "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-6","ariaLabel":"Back to reference 6","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-7"},"children":[{"type":"text","value":"Assuming only one line of Python bytecode is running allowed the writers of python interpreters to write simpler implementations. The trouble is, years later multi-threaded parallelization became important to many programming fields where performance is crucial. Now, existing Python implementations such as CPython are in trouble because the one-line assumption is fundamentally baked in to the underlying C and lifting the GIL as-is would break the interpreter. The "},{"type":"element","tag":"a","props":{"href":"https://www.youtube.com/watch?v=B_cQ0ykux_4","rel":["nofollow"]},"children":[{"type":"text","value":"\"Gilectomy\""}]},{"type":"text","value":", an attempt to remove the GIL from CPython, is a demonstration to that effect. "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-7","ariaLabel":"Back to reference 7","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-8"},"children":[{"type":"text","value":"This allows us to transform nested callbacks into a list, eliminating callback nesting. Not much later, the language introduced a syntactical wrapper for the promise API that uses the "},{"type":"element","tag":"span","props":{"className":["term","cursor-default","px-1","rounded"]},"children":[{"type":"text","value":"await"}]},{"type":"text","value":" keyword. This is an adoption of "},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Async/await","rel":["nofollow"]},"children":[{"type":"text","value":"syntax"}]},{"type":"text","value":" common to many languages, which enables giving asynchronous code a synchronous look, therefore arguably improving readability. "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-8","ariaLabel":"Back to reference 8","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"concurrency","depth":2,"text":"Concurrency","children":[{"id":"types-of-work","depth":3,"text":"Types of work"},{"id":"enhancing-performance","depth":3,"text":"Enhancing Performance"},{"id":"concurrency-1","depth":3,"text":"Concurrency"},{"id":"a-taste-of-real-world-concurrency","depth":3,"text":"A Taste of Real-world Concurrency"},{"id":"back-to-buzzwords","depth":3,"text":"Back to buzzwords"},{"id":"ack","depth":3,"text":"Ack"}]},{"id":"footnote-label","depth":2,"text":"Footnotes"}]}},"_type":"markdown","_id":"content:Concurrency.md","_source":"content","_file":"Concurrency.md","_extension":"md"},{"_path":"/ok-sometimes-async-await","_dir":"","_draft":false,"_partial":false,"_locale":"","title":"Ok, Sometimes Async Await","description":"","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"ok-sometimes-async-await"},"children":[{"type":"text","value":"Ok, Sometimes Async-Await"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Normally, I continue believing that the classic (well, ES6) "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"promise.then().catch().finally()"}]},{"type":"text","value":" is nicer than using the newer ES17 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"async-await"}]},{"type":"text","value":" syntax, because of function composability"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-1","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-1"},"children":[{"type":"text","value":"1"}]}]},{"type":"text","value":".\nThere are 2 cases where I think "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"async-await"}]},{"type":"text","value":" is neater, and one where it may perceivably come in handy:"}]},{"type":"element","tag":"h3","props":{"id":"_1-early-returnthrowing-errors"},"children":[{"type":"text","value":"1. Early Return/Throwing Errors"}]},{"type":"element","tag":"pre","props":{"className":"language-ts shiki shiki-themes synthwave-84","code":"async function returnEarly(): Promise<SomeType | undefined> {\n  if (someCondition) return;\n  await networkRequest();\n  if (someOtherCondition) return;\n  return await someOtherNetworkRequest();\n}\n","language":"ts","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":" function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" returnEarly"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"()"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE4450"},"children":[{"type":"text","value":" Promise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE4450"},"children":[{"type":"text","value":"SomeType"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":" |"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE4450"},"children":[{"type":"text","value":" undefined"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"> {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"someCondition"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"  await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" networkRequest"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"someOtherCondition"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" someOtherNetworkRequest"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This way, your function can return early concisely, "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"but still always return a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Promise"}]}]},{"type":"text","value":".\nThis is because, all values returned from an "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"async function"}]},{"type":"text","value":" are automatically wrapped in a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" if they aren't already. The equivalent code is pretty ugly:"}]},{"type":"element","tag":"pre","props":{"className":"language-ts shiki shiki-themes synthwave-84","code":"function returnEarly(): Promise<SomeType | undefined> {\n  if (someCondition) return Promise.resolve();\n  return networkRequest().then(() => {\n    if (someOtherCondition) return Promise.resolve();\n    return someOtherNetworkRequest();\n  });\n}\n","language":"ts","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" returnEarly"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"()"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE4450"},"children":[{"type":"text","value":" Promise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE4450"},"children":[{"type":"text","value":"SomeType"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":" |"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE4450"},"children":[{"type":"text","value":" undefined"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"> {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"someCondition"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE4450"},"children":[{"type":"text","value":" Promise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" networkRequest"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"    if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"someOtherCondition"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE4450"},"children":[{"type":"text","value":" Promise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" someOtherNetworkRequest"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"  });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"_2-promise-drilling"},"children":[{"type":"text","value":"2. Promise Drilling"}]},{"type":"element","tag":"pre","props":{"className":"language-js shiki shiki-themes synthwave-84","code":"async function hotPotato() {\n  const a = await networkRequestA();\n  const b = await networkRequestB(a);\n  return await networkRequestC(a, b);\n}\n","language":"js","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":" function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" hotPotato"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":" a"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FFFFFFEE"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" networkRequestA"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":" b"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FFFFFFEE"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" networkRequestB"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"a"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" networkRequestC"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"a"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"b"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sometimes, a computation requires a value several promises upstream. Using "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"async-await"}]},{"type":"text","value":", you see the entire function's scope trivially, so you don't need to drill down with the value."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The equivalent code is ugly:"}]},{"type":"element","tag":"pre","props":{"className":"language-js shiki shiki-themes synthwave-84","code":"function hotPotato() {\n  return A()\n    .then((a) => B(a).then((b) => [a, b]))\n    .then(([a, b]) => C(a, b));\n}\n","language":"js","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" hotPotato"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" A"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"    ."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"(("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"a"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" B"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"a"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":")."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"(("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"b"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":" ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"a"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"b"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"]))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"    ."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"((["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"a"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"b"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"]) "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" C"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"a"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"b"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"));\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"_3-object-asyncfunction"},"children":[{"type":"text","value":"3? [object AsyncFunction]"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This does not generally strike me as useful, but can theoretically come in handy."}]},{"type":"element","tag":"pre","props":{"className":"language-ts shiki shiki-themes synthwave-84","code":"Object.prototype.toString.call(async () => producePromise()); // '[object AsyncFunction]'\nObject.prototype.toString.call(() => producePromise()); // '[object Function]'\n","language":"ts","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE4450"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"prototype"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"toString"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":"call"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" producePromise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"()); "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#848BBD;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// '[object AsyncFunction]'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE4450"},"children":[{"type":"text","value":"Object"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"prototype"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":"toString"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":"call"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" producePromise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"()); "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#848BBD;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// '[object Function]'\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So the language gives us a way to know if a function was declared with the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"async"}]},{"type":"text","value":" modifier.\nIn some contrived scenario, we can imagine that it may be very useful to be able to check during runtime if the function will be asynchronous "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"before invoking it"}]},{"type":"text","value":"."}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"section","props":{"className":["footnotes"],"dataFootnotes":""},"children":[{"type":"element","tag":"h2","props":{"className":["sr-only"],"id":"footnote-label"},"children":[{"type":"text","value":"Footnotes"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{"id":"user-content-fn-1"},"children":[{"type":"text","value":"Composability: "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"fetchThing().then(doThing).catch(logError).finally(toFalse)"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-1","ariaLabel":"Back to reference 1","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"ok-sometimes-async-await","depth":2,"text":"Ok, Sometimes Async-Await","children":[{"id":"_1-early-returnthrowing-errors","depth":3,"text":"1. Early Return/Throwing Errors"},{"id":"_2-promise-drilling","depth":3,"text":"2. Promise Drilling"},{"id":"_3-object-asyncfunction","depth":3,"text":"3? [object AsyncFunction]"}]},{"id":"footnote-label","depth":2,"text":"Footnotes"}]}},"_type":"markdown","_id":"content:Ok, Sometimes Async-Await.md","_source":"content","_file":"Ok, Sometimes Async-Await.md","_extension":"md"},{"_path":"/typescript-typesystems-and-javascript","_dir":"","_draft":false,"_partial":false,"_locale":"","title":"TypeScript, TypeSystems And JavaScript","description":"","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"typescript-typesystems-and-javascript"},"children":[{"type":"text","value":"TypeScript, TypeSystems and JavaScript"}]},{"type":"element","tag":"h3","props":{"id":"buzzwords"},"children":[{"type":"text","value":"Buzzwords"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TypeScript (or “TS”) is a language built upon JavaScript (or “JS”), the primary (perhaps a vast, vast understatement) language used to program web applications. The term “built upon” is important here — TS is “strict superset” of JavaScript. This means that any valid JS program is also a valid TS program."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TypeScript (or TS) first appeared 9 years ago, in 2012. It is written and maintained by Microsoft. It is now one of the "},{"type":"element","tag":"a","props":{"href":"https://venturebeat.com/2020/12/02/github-python-and-typescript-gain-popularity-among-programming-languages/","rel":["nofollow"]},"children":[{"type":"text","value":"most popular"}]},{"type":"text","value":" programming tools in the world. If TS were a startup company, early investors would be breaking out the champagne. Without exaggerating, I think most webdevs would agree with me in thinking that it won’t be long before “vanilla” JS will no longer be shipped in any new commercial product. For anything more than a personal/hobby project, JS will be constrained in TS shackles."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the last two paragraphs irritated you, you’re not alone — they irritate me as well, although true. Buzzwords cut through all articles promoting some library or another, and they make it impossible to make actual value judgements. Moreover, they distract the reader from actual trends and move the focus from concepts to products. If C# were to switch out Java in its inception, do we envision a vastly different developmental landscape in the 90s? I’d argue against that. Rather, Java and its viable alternatives heralded the well-known trend (and one of more popular religions) of Object Oriented Programming, or OOP."}]},{"type":"element","tag":"h3","props":{"id":"an-example"},"children":[{"type":"text","value":"An Example"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So, the following case for TypeScript is actually a general case for using a type system in JavaScript programming. TypeScript is just the current best-in-class (by a wide chasm), and an objectively excellent candidate for accomplishing this goal. Let’s examine a very simple function in JS:"}]},{"type":"element","tag":"pre","props":{"className":"language-javascript shiki shiki-themes synthwave-84","code":"function multiply(x, y) {\n  return x * y;\n}\n","language":"javascript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" multiply"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"y"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":" x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":" *"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":" y"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let’s call this function:"}]},{"type":"element","tag":"pre","props":{"className":"language-javascript shiki shiki-themes synthwave-84","code":"multiply(2, 3); // = 6\n","language":"javascript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":"multiply"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#2EE2FA"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#2EE2FA"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"); "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#848BBD;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// = 6\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So thats very nice. We have a function that multiplies two numbers. But let’s call it with a string:"}]},{"type":"element","tag":"pre","props":{"className":"language-javascript shiki shiki-themes synthwave-84","code":"multiply(2, \"hello\"); // = NaN\n","language":"javascript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":"multiply"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#2EE2FA"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF8B39"},"children":[{"type":"text","value":"\"hello\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"); "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#848BBD;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// = NaN\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is obviously a nonsensical operation (although "},{"type":"element","tag":"a","props":{"href":"https://www.pythoncentral.io/use-python-multiply-strings/","rel":["nofollow"]},"children":[{"type":"text","value":"in Python"}]},{"type":"text","value":" multiplying 2 by “hello” would return “hellohello”. This is adorable) — and we receive NaN, which is a special value in JS which means “not a number” (complying with the "},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/NaN","rel":["nofollow"]},"children":[{"type":"text","value":"IEEE 754 floating point standard"}]},{"type":"text","value":"). So it was a syntactically legal operation, but I doubt anyone writing that function wants their function to be called with a string value. Accordingly, this function could be written in TS like this:"}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes synthwave-84","code":"function multiply(x: number, y: number) {\n  return x * y;\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" multiply"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE4450"},"children":[{"type":"text","value":" number"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"y"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE4450"},"children":[{"type":"text","value":" number"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":" x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":" *"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":" y"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We’ve simply told TS that we don’t allow non number inputs to be given to the function. Now the second function call with the string value is illegal — TypeScript will yell at you and your editor will highlight it with red, mean squiggly lined until you change it, optionally forbidding you to ship your code until you do. This may seem annoying at first — you must sprinkle type hints all around the place for TS to be happy, and it will yell at you if you dont obey your own rules. Migrating most of my company’s codebase was a lesson in patience in that regard. But the effort pays off in compound down the road, and let’s examine why."}]},{"type":"element","tag":"h3","props":{"id":"so-what"},"children":[{"type":"text","value":"So What"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"a","props":{"href":"https://www.python.org/dev/peps/pep-0020/","rel":["nofollow"]},"children":[{"type":"text","value":"Python zen"}]},{"type":"text","value":" teaches us “Explicit is better than implicit” — users familiar with type systems (who are gawking at my “discovery” of a feature existing in languages for over 45 years) might think I’m invoking this rule for readability reasons — as in, any person reading my multiply function with type hints will know immediately that the inputs are 2 numbers. This is true (although, TS has very powerful type inference, such that in many cases you may leave off type hints). Another valid point would be the functionality aspect — as I’ve mentioned, calling multiply with “hello” is now impossible, which is a great thing."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For me, though, the most compelling case for type systems is more conceptual. TS forces you to explicitly fill your programs with assertions that mirror your assumptions about the program. Let’s rewrite our multiplication function:"}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes synthwave-84","code":"function fruitPrice(basePrice: number, quantity: number) {\n  return basePrice * quantity;\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#36F9F6"},"children":[{"type":"text","value":" fruitPrice"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"basePrice"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE4450"},"children":[{"type":"text","value":" number"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"quantity"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FE4450"},"children":[{"type":"text","value":" number"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":" basePrice"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FEDE5D"},"children":[{"type":"text","value":" *"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FF7EDB"},"children":[{"type":"text","value":" quantity"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#BBBBBB"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This function works great in dev with mock data, we receive the price of fruit from the server and the quantity from the client. Before pushing to production, the backend dev tells us that due to new architecture decisions, the price of certain fruit may be undetermined — now we may receive null, or an empty string when asking for the price of a fruit. Now when I call the price function with this new value, which may be undefined or a number, TypeScript yells because it know I am passing in a value which may not be a legal number."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Again, this is great — my function would fail without a rewrite. But the real lesson I can take from the squiggly lines is about my assumptions. TS punishes you for a lenient or thoughtlessly written piece of code — it forces you to reexamine what you think the program actually does. So fruitPrice will undoubtedly have to change, but now you know where you casually gave yourself a break by assuming a stricter subset of input than in reality. Now you know your program must take an undetermined price into account. TS will selflessly tell you where this assumption is relevant, but the real takeaway is forcing you to more strictly define your program."}]},{"type":"element","tag":"h3","props":{"id":"but-typescript-though"},"children":[{"type":"text","value":"But TypeScript, Though"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Something must be said about the tool in order to encourage its’ use, aside from touting the general benefits of a type system. So why TS, after all?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"From a maintenance perspective, TS is, as mentioned, maintained by Microsoft. There are constant releases fixing bugs and meeting performance goals. New features are great, but really a dev needs to know that the project won’t "},{"type":"element","tag":"a","props":{"href":"https://www.theregister.com/2020/03/26/corejs_maintainer_jailed_code_release/","rel":["nofollow"]},"children":[{"type":"text","value":"collapse"}]},{"type":"text","value":" because of a dangerous dependency on a small team’s free time, and that the project won’t be "},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/CoffeeScript","rel":["nofollow"]},"children":[{"type":"text","value":"forgotten"}]},{"type":"text","value":" after a swift period of adoption. There are no guarantees, obviously, and no project lasts forever. But, for now, it seems like the buzzword period is mostly over — and the aftermath is major "},{"type":"element","tag":"a","props":{"href":"https://angular.io/guide/typescript-configuration","rel":["nofollow"]},"children":[{"type":"text","value":"libraries"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"https://deno.land/","rel":["nofollow"]},"children":[{"type":"text","value":"technologies"}]},{"type":"text","value":" have adopted TS, or "},{"type":"element","tag":"a","props":{"href":"https://reactjs.org/docs/static-type-checking.html#typescript","rel":["nofollow"]},"children":[{"type":"text","value":"at least actively maintain type declaration files and tooling"}]},{"type":"text","value":" for consumers. Bet on TypeScript."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I think one of the reasons for TS’s steady success is its’ core product — type systems for JS. It has cultivated many features that were eventually swallowed into vanilla JS — "},{"type":"element","tag":"a","props":{"href":"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html#optional-chaining","rel":["nofollow"]},"children":[{"type":"text","value":"optional chaining"}]},{"type":"text","value":", what seems like "},{"type":"element","tag":"a","props":{"href":"https://www.typescriptlang.org/docs/handbook/classes.html","rel":["nofollow"]},"children":[{"type":"text","value":"direct inspiration for JS es2015 classes"}]},{"type":"text","value":", "},{"type":"element","tag":"a","props":{"href":"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html#nullish-coalescing","rel":["nofollow"]},"children":[{"type":"text","value":"nullish coalescing"}]},{"type":"text","value":" etc. But really, the main feature which browsers cannot adopt is the type system — JS is inherently dynamic, and a type system is a radical change browsers cannot simply add in. So by not competing with juggernaut browsers over its’ main feature, it can prevail safely without fearing a sudden hostile takeover."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"From a non maintenance perspective, TS has built its’ type system around widely used JS patterns. One example is that the TS type system is "},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Structural_type_system","rel":["nofollow"]},"children":[{"type":"text","value":"structural"}]},{"type":"text","value":" rather than nominal — basically, that one value is equivalent to another if it shares the structure of the other value. For example, a function that recieves { a: number; } as an argument, will also accept { a: number; b: number; } — the second type can be treated as the first type for all intents and purposes that the first type is used for in the function."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In many other type systems, types can act in for other types only if an explicit (=nominal) relationship was tied between them, such as inheritance. A structural type system fits the JS pattern of constant usage of anonynous objects and values (including functions), without explicitly calling constructors and so forth. Forcing nonimal typing on existing JS code would change the style and patterns devs are used to. This is not the only advantage to a structural type system, but it illustrates the thinking behind the language design. For more on the unique fit between TS and JS (I didn’t even touch on the functional aspect), I strongly recommend watching "},{"type":"element","tag":"a","props":{"href":"https://www.youtube.com/watch?v=jmPZztKIFf4","rel":["nofollow"]},"children":[{"type":"text","value":"this talk"}]},{"type":"text","value":" by "},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Anders_Hejlsberg","rel":["nofollow"]},"children":[{"type":"text","value":"Anders Hejlsberg"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"giving-the-web-context"},"children":[{"type":"text","value":"Giving the Web Context"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In a final note, moving this text from notepad to an actual text editor with a spellchecker has shamefully revealed many squiggly lines, red, blue and green. In an imperfect analogy, JS editors have long had red lines for syntax errors (a.k.a. spelling mistakes). TS is more than a library, as it introduces a feature entirely impossible in current JS — green and blue squiggly lines, for contextual and grammatical errors. Suddenly my programs are more than blocks of black text, they speak to me and challenge my assumptions. So while we roll in the "},{"type":"element","tag":"a","props":{"href":"https://insights.stackoverflow.com/survey/2020#technology-what-languages-are-associated-with-the-highest-salaries-worldwide","rel":["nofollow"]},"children":[{"type":"text","value":"slim surplus of cash"}]},{"type":"text","value":" we supposedly make by writing TS over plain JS, let’s all collectively move our programs from notepad to a text editor."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://medium.com/@netanel.t.haber/typescript-typesystems-and-javascript-83153f249ce3?source=post_page-----83153f249ce3--------------------------------","rel":["nofollow"]},"children":[{"type":"text","value":"Originally published on February 27, 2021, on Medium"}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"typescript-typesystems-and-javascript","depth":2,"text":"TypeScript, TypeSystems and JavaScript","children":[{"id":"buzzwords","depth":3,"text":"Buzzwords"},{"id":"an-example","depth":3,"text":"An Example"},{"id":"so-what","depth":3,"text":"So What"},{"id":"but-typescript-though","depth":3,"text":"But TypeScript, Though"},{"id":"giving-the-web-context","depth":3,"text":"Giving the Web Context"}]}]}},"_type":"markdown","_id":"content:TypeScript, TypeSystems and JavaScript.md","_source":"content","_file":"TypeScript, TypeSystems and JavaScript.md","_extension":"md"}],"navigation":[{"title":"Concurrency","_path":"/concurrency"},{"title":"Ok, Sometimes Async Await","_path":"/ok-sometimes-async-await"},{"title":"TypeScript, TypeSystems And JavaScript","_path":"/typescript-typesystems-and-javascript"}]}